

<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="format-detection" content="telephone=no">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0">

    <meta property="og:type"   content="website" />
    <meta property="og:url" content="{{ path('guest_book_page', {hash: hash}) }}" />
    <meta property="og:description" content="Sổ lưu bút" />
    <meta property="og:title" content="Sổ lưu bút {{ data['groom_name'] }} - {{ data['bride_name'] }}" />
    <meta property="og:image" content="/bundles/viettutweb/img/templates/gardenwedding/img/S_7445cc41988e70ed839f0505739f50fb.jpg" />

    <title>Sổ lưu bút {{ data['groom_name'] }} - {{ data['bride_name'] }}</title>
    <link href="/bundles/viettutweb/img/thiepdo_120x120.png" sizes="120x120" rel="apple-touch-icon">
    <link rel="icon" sizes="144x144" href="/bundles/viettutweb/img/thiepdo_144x144.png">
    <link rel="icon" sizes="64x64" href="/bundles/viettutweb/img/thiepdo_64x64.png">

    <link rel="stylesheet" type="text/css" href="/bundles/viettutweb/css/templates/common/snsbbs.css?v=201706301332">
    <link rel="stylesheet" type="text/css" href="/bundles/viettutweb/css/lib/jquery.cropbox.custom.css" />

    <style>
        .snsbbs_wrap {overflow:hidden;}
    </style>

    <script type="text/javascript" src="/bundles/viettutweb/js/lib/jquery-1.11.1.min.js"></script>
    <script type="text/javascript" src="/bundles/viettutweb/js/lib/mustache.js"></script><em></em>
    <script type="text/javascript" src="/bundles/viettutweb/js/lib/masonry.pkgd.min.js"></script>
    <script type="text/javascript" src="/bundles/viettutweb/js/lib/imagesloaded.pkgd.min.js"></script>
    <script type="text/javascript" src="/bundles/viettutweb/js/lib/hammer.js"></script>
    <script type="text/javascript" src="/bundles/viettutweb/js/lib/jquery.mousewheel.js"></script>
    <script type="text/javascript" src="/bundles/viettutweb/js/lib/jquery.cropbox.custom.js"></script>

    <script>
        $(document).ready(function(){
            $(".header_area").css("height",$(".header_area").width() * 0.9);
            $(".header_wrap .recentlist_box").css("top",$(".header_area").outerHeight() + 50);
            $(window).bind("orientationchange, resize", function(e) {
                $(".header_area").css("height",$(".header_area").width() * 0.9);
                $(".header_wrap .recentlist_box").css("top",$(".header_area").outerHeight() + 50);
            });

            var HeaderHeight = $('.header_wrap').outerHeight(true);
//	$('.snsbbs_wrap').css({'padding-top':HeaderHeight});
//	$(window).bind("orientationchange, resize", function(e) {
//		var HeaderHeight = $('.header_wrap').outerHeight(true);
//		$('.snsbbs_wrap').css({'padding-top':HeaderHeight});
//	});
//	$('.header').css({'background-size':'cover'});

            $(window).scroll(function() {
                var scrollTop = $(window).scrollTop();
                //$('.header_wrap').css({'background-size':'calc(100% + '+(scrollTop*2)+'px'});

                if ( scrollTop > HeaderHeight ) {
                    $('.gnb_wrap,.btn_write').addClass('fixed');
                } else {
                    $('.gnb_wrap,.btn_write').removeClass('fixed');
                }
            });

            $("html, body").scroll(function() {
                var scrollTop = $(this).scrollTop();
                //$('.header_wrap').css({'background-size':'calc(100% + '+(scrollTop*2)+'px'});

                if ( scrollTop > HeaderHeight ) {
                    $('.gnb_wrap,.btn_write').addClass('fixed');
                } else {
                    $('.gnb_wrap,.btn_write').removeClass('fixed');
                }
            });
        });
    </script>
</head>
<body class="orange"> <!-- orange / blue / pink / mint -->
<div id="fb-root"></div>
<script>(function(d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s); js.id = id;
        js.src = 'https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.10&appId=1934863569863740';
        fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));</script>
<div id="cardId" data-id="{{ id }}"></div>
{% if app.user %}
<div id="userInfo" data-name="{{ app.user.name }}" data-avatar="{{ app.user.avatar }}"></div>
{% else %}
<div id="userInfo" data-name="nouser" data-avatar=""></div>
{% endif %}
<div class="snsbbs_wrap">

    <div class="gnb_wrap">
        <div class="color_bg"></div>
        <h1 class="title">LƯU BÚT</h1>
        <a href="{{ referrer }}"><div class="back"><span class="ico-back">Quay lại</span></div></a>
        <div class="menu"><span class="ico-menu">Menu</span></div>

        <div class="gnb_login" onclick="showLoginPopup()">
            <div class="write"><span class="ico-pencil">VIẾT</span></div>
        </div>
    </div>

    <div class="header_wrap">
        <div class="header_area" style="background:url('/bundles/viettutweb/img/templates/common/S_7445cc41988e70ed839f0505739f50fb.jpg') no-repeat center center;background-size:cover">
            <div class="header_contents">
                <div class="marrier">{{ groom }} & {{ bride }}</div>
                <div class="message">Ngày chung đôi</div>
                <div class="date"><span>{{ date | date('d.m.Y (l) H:i A') }} </span></div>
            </div>
            <div class="header_write" onclick="showLoginPopup()"><span class="ico-pencil">Viết</span></div>
        </div>
        <div class="recentlist_box" style="top: 374px;">
            <ul class="headertab_tabs recentlist_tabs">
                <li data-tab="hdrecent_tab1" class="on"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">New article</font></font><span class="color_txt count"></span></li>
                <li data-tab="hdrecent_tab2" class=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">New comments</font></font><span class="color_txt count"></span></li>
            </ul>
            <div class="headertab_area recentlist_area on" id="hdrecent_tab1">
                <ul><li id="norecent"><div class="norecent"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No new posts.</font></font></div></li></ul>
            </div>
            <div class="headertab_area recentlist_area" id="hdrecent_tab2">
                <ul><li id="norecent"><div class="norecent"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No new comments.</font></font></div></li></ul>
            </div>
        </div>

    </div>

    <div class="contents_wrap">
        <ul class="contents_list" id="contents_list">
            <div class="gutter"></div>
            <div class="content_size"></div>

            {% if comments | length > 0 %}
                {% for comment in comments %}
                    <li>
                        <div class="message_box">
                            <div class="message_area">
                                <div class="profile_area">
                                    <div class="profile_img">
                                        <img src="{{ comment.author.avatar }}" alt="Profile image" />
                                    </div>
                                </div>
                                <div class="text_area">
                                    <div class="user_name"><span>{{ comment.author.name }}</span></div>
                                    <p>{{ comment.content }}</p>
                                </div>
                            </div>
                            <div class="del_area">
                                <div class="info_date">
                                    <span> {{ comment.createdAt | date('d-m-Y H:i') }}</span>
                                </div>
                            </div>
                        </div>
                    </li>
                {% endfor %}
            {% endif %}
        </ul>
        <div class="popup_wrap" id="commentTemplate">
            <li>
                <div class="message_box">
                    <div class="message_area">
                        <div class="profile_area">
                            <div class="profile_img">
                                <img src="" alt="Profile image">
                            </div>
                        </div>
                        <div class="text_area">
                            <div class="user_name" id="name"></div>
                            <p id="content"></p>
                        </div>
                    </div>
                    <div class="del_area">
                        <div class="info_date">
                            <span id="date"></span>
                        </div>
                    </div>
                </div>
            </li>
        </div>
    </div>

    <div class="btn_write" onclick="showLoginPopup()">
        <span class="ico-pencil">Viết</span>
    </div>


    <div class="footer_wrap">
        <div class="logo"><span>thiepdo</span></div>
    </div>
</div>


<div class="mypage_wrap" id="">
    <div class="mypage_close"><span class="ico-popclose-g">Đóng</span></div>
    <div class="recentlist_box">
        <ul class="mypagetab_tabs recentlist_tabs">
            <li data-tab="recent_tab1" class="on">Bài viết mới<span class="color_txt count"></span></li>
            <li data-tab="recent_tab2" class="">Nhận xét mới<span class="color_txt count"></span></li>
        </ul>
        <div class="mypagetab_area recentlist_area on" id="recent_tab1">
            <ul>
            </ul>
        </div>
        <div class="mypagetab_area recentlist_area" id="recent_tab2">
            <ul>
            </ul>
        </div>
    </div>
    <div class="mypage_btns mypage_btns1">
        <div class="mypage_btn write color_bg"><span>Viết</span></div>
    </div>
</div>

{% if app.user %}
    <div class="popup_wrap popup_write" id="popup_login">
        <div class="popup_box">
            <div class="pop_title color_bg">Viết lưu bút</div>
            <div class="pop_write">
                <div class="profile_area">
                    <div class="profile_img">
                        <img src="{{ app.user.avatar }}" alt="avatar">
                    </div>
                    {#<div class="ico-sns-small notlogin"></div>#}
                </div>
                <div class="name_area">
                    <div class="user_name"><span>{{ app.user.name }}</span></div>
                </div>
                <div class="text_area">
                    <textarea class="ui-state-disabled" id="contents" placeholder="nhập nội dung"></textarea>
                </div>

                <div class="select_area">

                    <div id="div_emo_select" class="emo_select-hide" style="display:none;width:176px;">
                        <div id="bt_close_selecticon" class="emo_select_close"><span class="ico-minus-w">Đóng</span></div>
                    </div>
                </div>

                <div class="btn_area">
                    <div class="write_emo on" onclick="showEmoticon()"><i class="fa fa-smile-o"></i><span class="hidden">Biểu tượng</span></div><!--이모티콘선택하면 .on 추가-->
                    <div class="write_btn color_bg" onclick="postGreeting()"><span class="ico-pencil">Đăng</span></div>
                </div>
            </div>
            <div class="popup_close"><span class="ico-popclose-w">Đóng</span></div>

        </div>
    </div>
{% else %}
    <div class="popup_wrap popup_login" id="popup_login">
        <div class="popup_box">
            <div class="pop_title">
                <ul class="login_tabs">
                    <li class="on">Đăng nhập</li>
                </ul>
            </div>
            <div class="login_area on">
                <div class="social-buttons">
                    <a href="{{ facebookUrl }}" class="btn_login btn-fb social-login"><img width="50px" src="{{ asset('bundles/viettutweb/img/logos/facebook_circle_color-256.png') }}"/></a>
                    <a href="{{ zaloUrl }}" class="btn_login btn-zl"><img width="50px" src="{{ asset('bundles/viettutweb/img/logos/cach-ban-hang-zalo-hieu-qua.png') }}"/></a>
                </div>
                <form  method="POST" action="{{ path('fos_user_security_check') }}">
                    <ul class="login_form">
                        {% if csrf_token %}
                            <input type="hidden" name="_csrf_token" value="{{ csrf_token }}" />
                        {% endif %}
                        <li class="id_area">
                            <input type="text" id="nouser_name" name="_username" class="inp_id" placeholder="username">
                        </li>
                        <li class="pw_area">
                            <input type="password" id="nouser_password" name="_password" class="inp_pw" placeholder="password">
                            <input type="hidden" name="_target_path" value="{{ referrer }}" />
                        </li>
                        <li>
                            <button class="btn_login" id="bt_nouser_login">Đăng Nhập</button>
                        </li>
                    </ul>
                </form>
                <p class="alert_info">
                    {% if error %}
                        {{ error.messageKey|trans(error.messageData, 'security') }}
                    {% endif %}
                </p>
            </div>
            <div class="popup_close"><span class="ico-popclose-g">Đóng</span></div>
        </div>
    </div>
{% endif %}

<div class="popup_wrap popup_read" id="popup_read">
    <div class="popup_box">
        <div class="pop_read">
            <div class="pop_title color_bg">방명록 글읽기</div>
            <div class="message_box">
                <div class="message_area">
                    <div class="profile_area">
                        <div class="profile_img">
                            <img src="/img/snsbbs/nouser.png" alt="">
                        </div>
                        <div class="ico-sns-medium nouser"></div>
                    </div>
                    <div class="text_area">
                        <div class="user_name"></div>
                        <p></p>
                    </div>
                    <div class="reply_area">
                        <div class="reply_btn"><i class="fa fa-commenting-o fa-flip-horizontal color_txt"></i><span class="hidden">댓글</span><span class="reply_txt color_txt">0</span></div>
                    </div>
                    <div class="del_area">
                        <div class="del_btn"><span class="ico-trash">글삭제</span></div>
                        <div class="info_date"><span></span></div>
                    </div>
                </div>
            </div>

            <div class="comment_box">
                <div class="pop_emo_area">
                    <div class="pop_emo_box">
                        <div class="pop_emo_select emo-type-a emo09 hide" id="pop_emo_select" style="display:none; width: 120px;">
                            <div id="bt_pop_close_selecticon" class="emo_select_close"><span class="ico-close-w">삭제</span></div>
                        </div>
                    </div>
                </div>

                <div class="write_area">
                    <div class="write_emo"><i class="fa fa-smile-o"></i><span class="hidden">이모티콘 선택</span></div><!--이모티콘 선택하면 .on 추가-->
                    <div class="write_input"><input type="text" id="" placeholder="댓글 달기"></div>
                    <div class="write_btn color_bg"><span class="ico-pencil">등록</span></div>
                </div>
                <ul class="comm_list">
                </ul>
            </div>
            <div class="popup_arrow"><span class="ico-prev">이전글</span><span class="ico-next">다음글</span></div>
            <div class="popup_close"><span class="ico-popclose-w">닫기</span></div>
        </div>
    </div>
</div>
<!--//팝업:글읽기-->

<!--팝업:이모티콘-->
<div class="popup_wrap popup_icon" id="popup_icon">
    <div class="popup_box">
        <div class="emoticon_area" id="pop_icon">
            <ul class="popemo_tabs">
                <li data-tab="poptab_seta" class="popemo_tab popemo_taba on"><span>Loại A</span></li>
                <li data-tab="poptab_setb" class="popemo_tab popemo_tabb"><span>Loại B</span></li>
                <li data-tab="poptab_setc" class="popemo_tab popemo_tabc"><span>Ảnh</span></li>
            </ul>
            <ul class="popemo_list on" id="poptab_seta">
                <li><div class="popemoset emo-small-a emo01" id="emo01a"></div></li>
                <li><div class="popemoset emo-small-a emo02" id="emo02a"></div></li>
                <li><div class="popemoset emo-small-a emo03" id="emo03a"></div></li>
                <li><div class="popemoset emo-small-a emo04" id="emo04a"></div></li>
                <li><div class="popemoset emo-small-a emo05" id="emo05a"></div></li>
                <li><div class="popemoset emo-small-a emo06" id="emo06a"></div></li>
                <li><div class="popemoset emo-small-a emo07" id="emo07a"></div></li>
                <li><div class="popemoset emo-small-a emo08" id="emo08a"></div></li>
                <li><div class="popemoset emo-small-a emo09" id="emo09a"></div></li>
                <li><div class="popemoset emo-small-a emo10" id="emo10a"></div></li>
                <li><div class="popemoset emo-small-a emo11" id="emo11a"></div></li>
                <li><div class="popemoset emo-small-a emo12" id="emo12a"></div></li>
                <li><div class="popemoset emo-small-a emo13" id="emo13a"></div></li>
                <li><div class="popemoset emo-small-a emo14" id="emo14a"></div></li>
                <li><div class="popemoset emo-small-a emo15" id="emo15a"></div></li>
                <li><div class="popemoset emo-small-a emo16" id="emo16a"></div></li>
                <li><div class="popemoset emo-small-a emo17" id="emo17a"></div></li>
                <li><div class="popemoset emo-small-a emo18" id="emo18a"></div></li>
                <li><div class="popemoset emo-small-a emo19" id="emo19a"></div></li>
                <li><div class="popemoset emo-small-a emo20" id="emo20a"></div></li>
            </ul>
            <ul class="popemo_list" id="poptab_setb">
                <li><div class="popemoset emo-small-b emo01" id="emo01b"></div></li>
                <li><div class="popemoset emo-small-b emo02" id="emo02b"></div></li>
                <li><div class="popemoset emo-small-b emo03" id="emo03b"></div></li>
                <li><div class="popemoset emo-small-b emo04" id="emo04b"></div></li>
                <li><div class="popemoset emo-small-b emo05" id="emo05b"></div></li>
                <li><div class="popemoset emo-small-b emo06" id="emo06b"></div></li>
                <li><div class="popemoset emo-small-b emo07" id="emo07b"></div></li>
                <li><div class="popemoset emo-small-b emo08" id="emo08b"></div></li>
                <li><div class="popemoset emo-small-b emo09" id="emo09b"></div></li>
                <li><div class="popemoset emo-small-b emo10" id="emo10b"></div></li>
                <li><div class="popemoset emo-small-b emo11" id="emo11b"></div></li>
                <li><div class="popemoset emo-small-b emo12" id="emo12b"></div></li>
                <li><div class="popemoset emo-small-b emo13" id="emo13b"></div></li>
                <li><div class="popemoset emo-small-b emo14" id="emo14b"></div></li>
                <li><div class="popemoset emo-small-b emo15" id="emo15b"></div></li>
                <li><div class="popemoset emo-small-b emo16" id="emo16b"></div></li>
                <li><div class="popemoset emo-small-b emo17" id="emo17b"></div></li>
                <li><div class="popemoset emo-small-b emo18" id="emo18b"></div></li>
                <li><div class="popemoset emo-small-b emo19" id="emo19b"></div></li>
                <li><div class="popemoset emo-small-b emo20" id="emo20b"></div></li>
            </ul>
            <ul class="popemo_list" id="poptab_setc">
                <li><div class="popemoset emo-type-c emo01" id="emo01c"></div></li>
                <li><div class="popemoset emo-type-c emo02" id="emo02c"></div></li>
                <li><div class="popemoset emo-type-c emo03" id="emo03c"></div></li>
                <li><div class="popemoset emo-type-c emo04" id="emo04c"></div></li>
                <li><div class="popemoset emo-type-c emo05" id="emo05c"></div></li>
                <li><div class="popemoset emo-type-c emo06" id="emo06c"></div></li>
                <li><div class="popemoset emo-type-c emo07" id="emo07c"></div></li>
                <li><div class="popemoset emo-type-c emo08" id="emo08c"></div></li>
                <li><div class="popemoset emo-type-c emo09" id="emo09c"></div></li>
                <li><div class="popemoset emo-type-c emo10" id="emo10c"></div></li>
                <li><div class="popemoset emo-type-c emo11" id="emo11c"></div></li>
            </ul>
        </div>
        <div class="popup_close"><span class="ico-popclose-g">닫기</span></div>
    </div>
</div>
<!--//팝업:이모티콘-->

<script>
    $(document).ready(function(){
        $('.contents_list').masonry({
            // options
            itemSelector: 'li',
            columnWidth: 200
        });

        $(".popup_close").on("click", function(){
            $('#popup_login').removeClass('on');

            if(!$("#popup_write, .mypage_wrap").hasClass("on")) {
                top = -($body.offset().top);
                $body.removeClass("noscroll").css("top", "");
                $("html, body").scrollTop(top);
            }
        });
    });


    function addComment(content) {
        var name = $('div#userInfo').data('name');
        var avatar = $('div#userInfo').data('avatar');
        $('div#commentTemplate img').attr('src', avatar);
        $('div#commentTemplate div#name').html(name);
        $('div#commentTemplate p#content').html(content);
        $('div#commentTemplate span#date').html(getCurrentDateTime());
        $('div.content_size').after($('div#commentTemplate').html());
        $('.contents_list').masonry({
            // options
            itemSelector: 'li',
            columnWidth: 200
        });
    }

    function getCurrentDateTime() {
        var today = new Date();
        var day = today.getDate();
        var month = today.getMonth()+1;
        var year = today.getFullYear();

        if (day < 10) {
            day = '0' + day;
        }

        if (month < 10 ) {
            month= '0' + month;
        }

        return day + '-' + month + '-' + year;
    }

    function showLoginPopup() {
        var $body = $("body");
        var top = $body.scrollTop() ? -($body.scrollTop()) : -($("html, body").scrollTop());

        $("#popup_login").addClass("on");
        $body.addClass("noscroll").offset({"top": top});
    }

    function showEmoticon() {
        $('#popup_icon').addClass('on');
    }

    function postGreeting() {
        var content = $('textarea#contents').val();
        if (content.length < 3) {
            alert('Nội dung quá ngắn!');
            return;
        }
        var data = {'card': $('#cardId').data('id'), 'content': content};
        $.post('/app_dev.php/api/v1/comments', data, function (response) {
            addComment(content);
            $('#popup_login').removeClass('on');
        }, 'json');
    }
</script>
</body>
</html>
